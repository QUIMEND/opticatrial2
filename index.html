// 1. Esta función muestra tu página web cuando entras al link
function doGet() {
  return HtmlService.createHtmlOutputFromFile('Index')
      .setTitle('Sistema de Control - Óptica')
      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}

// 2. Esta función recibe los datos del formulario y los guarda en la hoja
function doPost(e) {
  try {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // Crear encabezados si es hoja nueva
    if (sheet.getLastRow() === 0) {
      sheet.appendRow([
        'Nº Ticket', 'Cliente', 'Fecha', 'Nombre Aro', 'Código Aro', 
        'Color', 'Material', 'Tipo Aro', 'Medidas', 'Promo Aro Gratis', 
        'Valor', 'Fecha Registro'
      ]);
    }
    
    // Obtener datos enviados desde el HTML
    var p = e.parameter;
    var fechaFormateada = new Date().toLocaleString('es-ES', {timeZone: 'America/El_Salvador'});
    
    sheet.appendRow([
      p.numero, p.cliente, p.fecha, p.nombreAro, p.codigoAro,
      p.color, p.material, p.tipoAro, p.medidas, p.promoGratis,
      p.valor, fechaFormateada
    ]);
    
    return ContentService.createTextOutput(JSON.stringify({'result': 'success'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({'result': 'error', 'error': error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
